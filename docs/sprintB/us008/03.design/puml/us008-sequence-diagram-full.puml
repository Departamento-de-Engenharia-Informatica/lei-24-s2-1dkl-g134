@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Fleet Manager" as FM
participant "GenerateMaintenanceReportUI" as UI
participant "GenerateMaintenanceReportController" as CTRL
participant "VehicleRepository" as VR
participant "Vehicle\n:Vehicle" as V
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant ":ApplicationSession" as _APP
participant "appSession\n:ApplicationSession" as APP
participant "currentSession\n:UserSession" as SESSAO
participant "organizationRepository:\nOrganizationRepository" as OrganizationRepository
participant "organization\n:Organization" as ORG


activate FM

        FM -> UI : requests to generate maintenance report

        activate UI

'            UI --> ADM : requests data (reference, description,  informal \n description, technical description, duration, cost)
            'create CTRL

            UI -> CTRL** : choose vehicle

            UI -> CTRL : getVehicle()
            activate CTRL

                |||
                CTRL -> CTRL : getEmployeeOrganization()
                activate CTRL

                    CTRL -> _APP: getInstance()
                    activate _APP
                        _APP -> CTRL: appSession
                    deactivate _APP


                    CTRL -> APP: getCurrentSession()
                    activate APP

                        APP --> CTRL: currentSession
                    deactivate APP

                    CTRL -> SESSAO: email = getUserEmail()
                    activate SESSAO

                        SESSAO --> CTRL: email
                    deactivate SESSAO

                    CTRL -> RepositorySingleton: getInstance()
                    activate RepositorySingleton

                    RepositorySingleton --> CTRL: repositories
                    deactivate RepositorySingleton

                    CTRL -> PLAT: getOrganizationRepository(email)
                    activate PLAT

                        PLAT --> CTRL: organizationRepository
                    deactivate PLAT


                    CTRL -> OrganizationRepository: getOrganizationByEmployeeEmail(email)
                    activate OrganizationRepository

                        loop for each organization

                            OrganizationRepository -> ORG : anyEmployeeHasEmail(email)
                            activate ORG

                                 ORG --> OrganizationRepository : true/false
                            deactivate ORG
                        end
                        OrganizationRepository --> CTRL : organization
                    deactivate OrganizationRepository


                CTRL -> ORG: getLatestMaintenanceForVehicles(vehicleList)
                activate ORG

                ORG --> CTRL: maintenanceList
                deactivate ORG

                CTRL --> UI :maintenanceList
            deactivate CTRL

            UI --> FM :  shows maintenance report
        deactivate UI

        FM -> UI : choose vehicle to register check-up
                 activate UI

        UI -->  FM : requests data (vehicle, date, current km)
                 deactivate UI
        FM -> UI : inputs requested data
                activate UI

                 UI -> CTRL : RegisterVehicleCheckup(vehicle, date, current km)
                 activate CTRL

   CTRL -> V : RegisterVehicleCheckup(vehicle, date, current km)
                          activate V

              V -> CheckUp** : Create


              V ->V : addCheckUp(checkUp)
              activate V

              V->V : validateCheckup(checkUp)
              activate V



              V--->CTRL : CheckUp

                          deactivate V
              CTRL ---> UI : CheckUp
                          deactivate CTRL

              UI ---> FM : displays operation success
                          deactivate UI


@enduml